---
layout: default
title: 로그 기반 회복
parent: 6. 데이터 회복
grand_parent: DB (데이터베이스)
nav_order: 1
---

# 데이터베이스 회복기법 (Log-based Recovery)
{: .fs-8 }

6.1 로그 기반 회복
{: .label .label-purple }

> 암기: **회로체그아**

---

## 핵심 키워드

`REDO` `UNDO` `즉시갱신` `지연갱신` `체크포인트` `그림자페이지`

---

## 정의/개념

데이터베이스 장애는 Media, Syntax, Fat-Finger 문제로 발생되며 로그기반, 체크포인트, 그림자 페이지 등의 기술을 이용하여 일관성, 무결성, 가용성을 확보 및 보장 수행하는 기법

---

## 유형

### 즉시갱신 기법

```
트랜잭션 시작     갱신      갱신
      │           │        │
      ▼           ▼        ▼
┌─────────────────────────────┐
│           완료               │
└─────────────────────────────┘
      │
      │ "UNDO"
      ▼
   ┌─────┐      ┌─────┐
   │ Log │ ──▶  │  DB │
   └─────┘      └─────┘
```

- 트랜잭션 갱신 Log, DB 반영
- 장애시 Log 파일 참조 UNDO 연산

### 지연갱신 기법

```
트랜잭션 시작     갱신      갱신
      │           │        │
      ▼           ▼        ▼
┌─────────────────────────────┐
│           완료(DB 종료후 반영)│
└─────────────────────────────┘
      │
      │ "폐기"
      ▼
   ┌─────┐
   │ Log │
   └─────┘
```

- 트랜잭션 갱신 Log 반영(DB 종료후 반영)
- 장애시 Log 폐기(미종료), REDO 연산(종료)

### 체크포인트

```
      T1
    ──────┼─────────────────────────────────▶
         T2
      ─────────┼────────────────────────────▶
               T3
            ──────────┼─────────────────────▶
                       T4
                    ─────────────────┼──────▶
                                      T5
                                   ────┼───▶
                                         T6
                                      ────────▶
      │         │                        │
    검사점1   검사점2                  장애 시점
```

- 검사점 기준 로그 파일 기록
- UNDO(미종료), REDO(종료), UNDO 실행 후 REDO

### 그림자 페이지

```
   주기억장치          트랜잭션 시작           하드디스크
┌──────────┐                              ┌──────────────┐
│  페이지   │      ①생성     ②변경       │  그림자 페이지│
│  테이블   │────────────────────────────▶│    테이블    │
└──────────┘                              └──────────────┘
                          │
                          │ ③저장
                          │
            ┌─────────────┴─────────────┐
            │       트랜잭션 종료         │
            │    ④장애시 복구            │
            └───────────────────────────┘
```

- 트랜잭션 시작 전 그림자 페이지 테이블 생성
- 트랜잭션 종료 후 저장 및 장애 시 페이지 복구

---

## ARIES 알고리즘

```
┌─────────┐          ┌─────────┐
│  ① Log  │          │② 트랜잭션│
│- WAL 기록│          │- 장애시점 정보│
└────┬────┘          └────┬────┘
     │                    │
     │    CheckPoint      │
     │         │          │
     ▼         ▼          ▼
┌─────────┐  ┌────────────────┐  ┌───────────┐
│  REDO   │  │                │  │   UNDO    │
│- 재실행 반복처리│◀──│  CheckPoint   │──▶│- 무효화 로그 기록│
│- 완료 트랜잭션 │  │                │  │- 미완료 트랜잭션│
└─────────┘  └────────────────┘  └───────────┘
│                                          │
│                ③ Dirty Page              │
│                - 미완료 데이터             │
└──────────────────────────────────────────┘
```

- WAL(Write-Ahead Logging) 및 LSN(Log Sequence Number) 이용하는 회복 기법

---

## 연계 토픽

- [체크포인트](/docs/db/06-recovery/checkpoint)
- [그림자 페이지](/docs/db/06-recovery/shadow-paging)
- [ARIES](/docs/db/06-recovery/aries)

---

## 학습 체크리스트

- [ ] 개념 이해
- [ ] 핵심 키워드 암기
- [ ] 실무 적용 사례 파악

---

## 참고자료

- 정보관리기술사 데이터베이스 학습자료
