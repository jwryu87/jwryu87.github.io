---
layout: default
title: Two Phase Locking (2PL)
parent: 5. 동시성 제어
grand_parent: DB (데이터베이스)
nav_order: 2
---

# Two Phase Locking (2PL) / 2PC (Two-Phase Commit)
{: .fs-8 }

5.2 2단계 잠금
{: .label .label-purple }

---

## 핵심 키워드

`서버` `조정자` `지역노드` `Commit Point Site` `클라이언트`

---

## 정의/개념

분산 DB 환경 트랜잭션 원자성 보장 모든 노드가 Commit 또는 Rollback 현상

---

## 수행절차 (2PC(Two-Phase Commit)의 수행절차)

```
                  ┌──────────────────┐
                  │      Global      │ ─── 2. Commit Point Site 결정
                  │   Coordinator    │
                  └────────┬─────────┘
                           │
              3.Prepare 메시지 전송│
                           │              5.Commit/
                           │              Rollback결정
    1. 커밋요청             │
           ↓           ┌───┴───┐
                       │3.Prepare│
                       │메시지 응답│
                       └───┬───┘
                           │
    ┌─────────┬────────────┼────────────┬─────────┐
    │         │            │            │         │
    ▼         ▼            ▼            ▼         ▼
┌───────┐ ┌───────┐ ┌───────┐        ┌───────┐
│지역노드 1│ │지역노드 2│ │지역노드 3│ • • • • │지역노드 N│
└───────┘ └───────┘ └───────┘        └───────┘
```

- 지역노드에서 commit 요청을 하면 중앙조정자가 모든 지역노드의 응답을 기다리다가 준비 완료를 확인하면 commit or Rollback 명령을 내림

---

## 구성요소 (2PC(Two-Phase Commit)의 구성요소)

| 구성 요소 | 설명 | 특징 |
|:---------|:-----|:-----|
| **서버<br>(Server)** | - 분산 트랜잭션에 참여하는 모든 노드 | 조정자와 모든 지역노드 |
| **조정자** | - 분산 트랜잭션에 참여하는 참여자 목록을 가지며 Commit및 Rollback을 결정함 | 분산 트랜잭션 및 Global Commit을 처음 시작 |
| **지역노드** | - 지역(local) 트랜잭션을 수행하는 서버 | 다른 노드의 결과를 참조해야 하는 노드 |
| **Commit<br>Point Site** | - 분산 트랜잭션을 참여하는 노드 중 처음으로 커밋과 롤백을 수행하는 노드 | 가일 중요한 데이터 포함 |
| **클라이언트** | - 다른 노드의 데이터베이스를 이용하는 노드 | 사용자 노드 |

- 2PC는 신뢰성 및 상호 호환성 측면에서의 한계점을 가지고 있기에 이를 해결할 수 있는 방안이 필요함

---

## Two Phase Locking (2PL)

### 개념

트랜잭션의 직렬가능성을 보장하기 위한 잠금 프로토콜

### 단계

| 단계 | 설명 |
|:-----|:-----|
| **Growing Phase<br>(확장 단계)** | 트랜잭션이 필요한 잠금을 획득하는 단계<br>잠금 해제 불가 |
| **Shrinking Phase<br>(축소 단계)** | 트랜잭션이 잠금을 해제하는 단계<br>새로운 잠금 획득 불가 |

### 종류

| 종류 | 설명 |
|:-----|:-----|
| **Basic 2PL** | 기본 2단계 잠금 프로토콜 |
| **Strict 2PL** | 모든 배타적 잠금을 트랜잭션 종료까지 유지 |
| **Rigorous 2PL** | 모든 잠금(공유/배타)을 트랜잭션 종료까지 유지 |

---

## 연계 토픽

- [Locking](/docs/db/05-concurrency/locking)
- [분산 DB](/docs/db/02-db-basics/distributed-db)
- [MVCC](/docs/db/05-concurrency/mvcc)

---

## 학습 체크리스트

- [ ] 개념 이해
- [ ] 핵심 키워드 암기
- [ ] 실무 적용 사례 파악

---

## 참고자료

- 정보관리기술사 데이터베이스 학습자료
