---
layout: default
title: Locking
parent: 5. 동시성 제어
grand_parent: DB (데이터베이스)
nav_order: 1
---

# 데이터베이스 병행제어 (Concurrency Control)
{: .fs-8 }

5.1 잠금 기반 동시성 제어
{: .label .label-purple }

> 암기: **락타낙다**

---

## 핵심 키워드

`직렬성` `무결성` `Locking` `2PL` `Timestamp` `낙관적 검증` `MVCC`

---

## 정의/개념

다중 사용자 환경을 지원하는 데이터베이스 시스템에서 여러 트랜잭션들이 직렬성 및 무결성을 보장하고 성공적으로 동시에 실행될 수 있도록 지원하는 제어 기법

---

## 유형

### Locking

```
┌─────────────────────────────────────┐
│              법                     │
│  ┌───────┬───────┬───────┬───────┐ │
│  │ 데이터│ 데이터│ 데이터│ 데이터│ │
│  │   1  │   2  │   3  │   4  │ │
│  └───────┴───────┴───────┴───────┘ │
└─────────────────────────────────────┘
```

- 트랜잭션이 사용하는 자원에 대하여 상호 배제(Mutual Exclusive) 기능을 제공하는 기법
- 상호배제는 특정 트랜잭션이 데이터 항목에 대하여 잠금(Lock)을 설정한 트랜잭션이 해제(unlock) 할 때까지 데이터를 독점적으로 사용할 수 있는 것

### 2PL (Phase Lock)

```
       lock              unlock
        │      lock   X3   unlock
        │       │     X2    │
        │       │     X1    │
        │       │           │      시간
────────┼───────┼───────────┼──────▶
      확장      잠금        수축
      단계     (갱신)       단계
```

- 모든 트랜잭션들이 Lock과 Unlock 연산을 확장 단계와 수축 단계로 구분하여 수행
- 확장단계: 트랜잭션은 lock만 수행할 수 있고, unlock은 수행할 수 없는 단계
- 수축단계: 트랜잭션은 unlock만 수행할 수 있고, lock은 수행할 수 없는 단계

### Timestamp

```
       스케줄러
┌───────────┐
│ 트랜잭션  │──────▶ Timestamp Ordering ──────▶ Execution lock
└───────────┘
```

- 시스템에서 생성하는 고유 번호인 시간 스탬프를 트랜잭션에 부여하는 것으로 트랜잭션 간의 순서를 미리 선택하는 것 (시스템 시계, 논리적 계수기 등 활용)

---

## 낙관적 검증 (Validation)

```
트랜잭션    트랜잭션
  시작        종료
    │         │
    ▼         ▼
┌─────┐  ┌─────┐  ┌─────┐
│동시성│  │동시성│  │     │
│검증  │──│ 검증 │──│commit│
│연기  │  │     │  │     │
└─────┘  └─────┘  └─────┘
```

- 트랜잭션이 어떠한 검증도 수행하지 않고, 일단 트랜잭션을 수행하고, 트랜잭션 종료 시 검증을 수행하여 데이터베이스에 반영

---

## 다중버전 병행 제어 (MVCC)

```
        start BCN 100
         │
         ▼
    ┌─────────┐
    │   100   │
    │    95   │◀─────┐
    │   101   │      │ Undo
    ├─────────┤      │
    │   94    │      │
    └─────────┘      │
                     │
         Scan Path   │
```

- 하나의 데이터 아이템에 대해 여러 버전의 값 유지
- 트랜잭션의 타임스탬프와 접근하려는 데이터 아이템의 여러 버전의 타임스탬프를 비교하여, 현재 실행하고 있는 스케줄의 직렬 가능성이 보장되는 적절한

---

## 연계 토픽

- [직렬성](/docs/db/04-transaction/isolation-level)
- [Two Phase Locking](/docs/db/05-concurrency/two-phase-locking)
- [MVCC](/docs/db/05-concurrency/mvcc)

---

## 학습 체크리스트

- [ ] 개념 이해
- [ ] 핵심 키워드 암기
- [ ] 실무 적용 사례 파악

---

## 참고자료

- 정보관리기술사 데이터베이스 학습자료
