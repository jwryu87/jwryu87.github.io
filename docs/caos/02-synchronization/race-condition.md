---
layout: default
title: 경쟁조건
parent: 2. 동기화
grand_parent: CAOS (컴퓨터구조/OS)
nav_order: 1
---

# 경쟁조건 (Race Condition)
{: .fs-8 }

2.1 문제
{: .label .label-red }

> 암기: **충족조건(상진한), HW(테스인), SW(데피램)**

---

## 핵심 키워드

`공유자원` `임계구역` `동시접근` `동기화` `타이밍` `순서`

---

## 정의/개념

**경쟁조건(Race Condition)**은 다수 프로세스 혹은 스레드가 변경, 수정 가능한 **공유 데이터 접근** 시 실행 순서에 따라 실행 결과가 달라지는 **비정상적 상태**입니다.

---

## 경쟁조건 메커니즘

```
              add
               │
Thread A ──┬──10───┬──10 + 7 = 17──┐
           │       │               │
           │       │      add      │
           │       │       │       │
Thread B ──┴───────┴──10───┴──10 + 5 = 15──┐
                                           │
           read    read       write  write │
             │       │          │      │   │
Integer ────10──────────────────17────15───┘
                                      │
                              Time ───┘
```

위 예시에서 Thread A와 B가 동시에 공유 변수 Integer에 접근할 때, 실행 순서에 따라 결과가 달라집니다.

---

## 경쟁조건 해결방안

### 1) 충족조건

| 충족 조건 | 설명 | 특징 |
|:---------|:-----|:-----|
| **상호 배제 (Mutual Exclusion)** | 어떤 프로세스가 임계 영역을 수행 중이면 다른 프로세스들은 그 임계 영역을 사용할 수 없음 | 임계 영역 동시 접근 불가 |
| **진행 (Progress)** | 아무것도 임계 영역에 있지 않은 상태에서는 임계 영역 사용 가능 | Livelock 제어 |
| **한계 대기 (Bounded Waiting)** | 임계 영역에 들어가려고 요청한 후부터 허용될 때까지 다른 프로세스의 임계 영역 사용 횟수에 한계 존재 | Starvation 제어 |

### 2) 해결방안

#### 소프트웨어 기법

| 기법 | 설명 |
|:-----|:-----|
| **Dekker** | - 두개의 프로세스를 위한 상호배제의 최초 소프트웨어 해결법<br>- flag, turn 변수 사용<br>- 임계영역 진입을 먼저 시도하고 완료 후 진입 순서 양보 |
| **Peterson** | - 상호배제를 위한 병렬 프로그램 알고리즘<br>- flag, turn 변수 사용<br>- 상대 프로세스에 먼저 기회를 양보하고 이후 임계영역 진입 |
| **Lamport** | - 분산처리 환경에 유용한 알고리즘<br>- 번호표를 부여 받고 낮은 번호를 갖는 프로세스 먼저 수행 |

#### 하드웨어 기법

| 기법 | 설명 |
|:-----|:-----|
| **Test & Set** | - 시스템에서 제공하는 하드웨어 명령어 상태를 점검하고 변경을 수행함<br>- 원자적 수행<br>- 단일 Word 검사, 어를 이용한 기법 |
| **Compare & Swap** | - 시스템에서 제공하는 하드웨어 명령어 두개의 내용을 한번에 변경함<br>- 다중 Word 검사 |
| **인터럽트 금지** | - 임계영역 실행 완료까지 인터럽트 발생을 차단하는 기법<br>- 단일 프로세스 적용 가능, 멀티 프로세스 적용 불가<br>- 문제되는 코드부분에서 인터럽트를 disable(0) 수행, 원자성 확보<br>- 인터럽트를 꺼버리면 내부적으로 Context Switching 불가능함 |

#### 동기화 기법

| 기법 | 설명 |
|:-----|:-----|
| **세마포어** | - 운영체제내 값으로 프로세스를 동기화시켜 자원을 사용<br>- 초기화 > P 연산 > V 연산 과정 수행<br>- Binary, Count 세마포어 구현 |
| **모니터** | - 고수준의 동기화를 제공<br>- 프로시저, 변수, 데이터 구조로 구성되어 있음<br>- 프로그래밍 언어가 모니터를 지원해야 함 |
| **임계영역** | - 병렬컴퓨팅에서 둘 이상의 스레드가 동시에 접근해서는 안되는 공유 자원 영역<br>- 임계영역에 진입이 불가능할 때 진입이 가능할 때까지 루프를 돌면서 재시도하는 방식으로 구현함 |
| **Spin Lock** | - 임계영역에 진입이 불가능할 때 진입이 가능할 때까지 루프를 돌면서 재시도하는 방식으로 구현함 |
| **Mutex** | - pthread에서 제공하는 동기화 매커니즘으로 공유 자원 공간에 대한 접근 시간제어로 동기화 달성 |

---

## 연계 토픽

- [Mutual Exclusion](/docs/caos/02-synchronization/mutual-exclusion)
- [세마포어](/docs/caos/02-synchronization/semaphore)
- [뮤텍스](/docs/caos/02-synchronization/mutex)
- [교착상태](/docs/caos/03-deadlock/deadlock)

---

## 학습 체크리스트

- [ ] 경쟁조건 발생 원인 이해
- [ ] 충족조건 3가지 암기 (상호배제, 진행, 한계대기)
- [ ] 소프트웨어 해결 기법 (Dekker, Peterson, Lamport)
- [ ] 하드웨어 해결 기법 (Test & Set, Compare & Swap)

---

## 참고자료

- 정보관리기술사 컴퓨터구조/OS 학습자료

