---
layout: default
title: 우선순위 역전
parent: 1. CPU 스케줄링
grand_parent: CAOS (컴퓨터구조/OS)
nav_order: 3
---

# 우선순위 역전 (Priority Inversion)
{: .fs-8 }

1.2 효과/문제
{: .label .label-yellow }

---

## 핵심 키워드

`임계영역` `프로세스 선점` `자원` `우선순위 상속` `우선순위 올림`

---

## 정의/개념

**우선순위 역전(Priority Inversion)**은 스케줄링과 동기화 사이의 상호작용 결과로, 임계영역 대기 때문에 **우선순위가 낮은 태스크에 의해 우선순위가 높은 태스크의 실행이 block** 되고 **CPU 점유를 내주는 현상**입니다.

---

## 우선순위 역전 현상 메커니즘

```
  우선순위↑
     │    ① 임계영역 대기(wait)
     │        │
Task1├────────┼────────┐
     │        │        │  ② 프로세스 선점
     │        ▼        ▼
Task2│                      ┌───────────┐
     │                      │   Task2   │
     │        ③ 임계영역 진입
     │            │
Task3├────────────┼────────────────────────────────┐
     │            │                                │
     │   ┌───────┴───────┐     ┌────────┐    ┌────┴────┐
     │   │    Task3      │     │ Task3  │    │  Task3  │
     │   │               │     │        │    │         │
     └───┴───────────────┴─────┴────────┴────┴─────────┴──▶ 시간
                         │
              ④ 우선순위 역전
                    
                   자원 R
```

### 발생 과정

| 단계 | 설명 |
|:-----|:-----|
| ① 임계영역 진입 | Task3는 자원 R을 사용하기 위하여 임계영역 진입 |
| ② 프로세스 선점 | 우선순위가 높은 Task1은 Task3 선점하고 스케줄링 되어 수행 |
| ③ 임계영역 대기 | Task1은 수행 중 자원 R이 필요하지만 Task3가 진입하여 있으므로 waiting하고 Task3 수행 |
| ④ 우선순위 역전 | Task3보다 우선순위가 높은 Task2가 선점하여 스케줄링되고, 가장 높은 우선순위 Task1은 계속 대기하게 되는 우선순위 역전 현상 발생 |

---

## 우선순위 역전 현상 해결방안

### 1) 우선순위 상속 (Priority Inheritance)

임계영역에 진입한 **우선순위가 낮은 Task의 우선순위**를 진입 대기하는 **높은 우선순위의 Task와 동일하게 부여**합니다.

```
  우선순위↑      ① 임계영역 대기(wait)
     │               │
Task1├───────────────┼─────────────────────────────────┐
     │               │       ② 프로세스 선점        │
     │               ▼       ③ 우선순위 상속        │
Task2│                            ┌─────────────┐    │
     │                            │  Task2 대기 │    │
     │                            │             │    │
Task3│           ④ 역전현상 해결  └─────────────┘    │
     │               │                               │
     │   ┌─────┬─────┴─────┐   ┌─────────┐  ┌──────┐│
     │   │Task3│   Task3   │   │ Task1   │  │Task1 ││
     │   │     │           │   │         │  │      ││
     └───┴─────┴───────────┴───┴─────────┴──┴──────┴┴──▶ 시간

                    자원 R
```

### 2) 우선순위 올림 (Priority Ceiling)

임계영역의 **자원 R에 우선순위를 부여**하고 해당 임계영역에 진입하는 **Task의 우선순위를 자원의 우선순위로 올림**합니다.

```
  우선순위↑              ① 임계영역 진입& 우선순위 올림
     │                        │
     │          자원 R    ┌───┴──────────────────────────────┐
     │                    │                                  │
Task1│                    │       ┌─────────┐    ┌─────────┐│
     │                    │       │ Task1 대기│   │ Task1   ││
     │                    │       │ ④ 역전현상│   │ ⑤ 역전현상││
     │                    │       │    예방   │   │   해결  ││
Task2│                    │       │          │   │         ││
     │                    │       │┌────────┐│   │         ││
     │                    │       ││Task2 대기│   │         ││
     │                    │       │└────────┘│   │         ││
Task3│   ② 임계영역 진입  │       └──────────┘   └─────────┘│
     │        │          │            │              │      │
     │   ┌────┴────┬─────┴─────┐ ┌────┴────┐   ┌────┴────┐ │
     │   │  Task3  │   Task3   │ │  Task3  │   │  Task3  │ │
     │   │         │           │ │         │   │         │ │
     └───┴─────────┴───────────┴─┴─────────┴───┴─────────┴─┴──▶ 시간

                    자원 R
```

---

## 해결방안 비교

| 구분 | 우선순위 상속 | 우선순위 올림 |
|:-----|:-------------|:-------------|
| **방식** | Task의 우선순위를 대기 중인 높은 Task와 동일하게 | 자원에 우선순위 부여, Task가 자원의 우선순위로 상승 |
| **장점** | 구현 상대적 단순 | 연쇄 블로킹 방지 |
| **단점** | 연쇄 블로킹 가능 | 구현 복잡 |

---

## 연계 토픽

- [CPU 스케줄링](/docs/caos/01-cpu-scheduling/cpu-scheduling)
- [호위효과/노화](/docs/caos/01-cpu-scheduling/convoy-effect-aging)
- [교착상태](/docs/caos/03-deadlock/deadlock)

---

## 학습 체크리스트

- [ ] 우선순위 역전 발생 원인 이해
- [ ] 우선순위 상속 기법 이해
- [ ] 우선순위 올림 기법 이해
- [ ] 두 해결방안 비교

---

## 참고자료

- 정보관리기술사 컴퓨터구조/OS 학습자료

